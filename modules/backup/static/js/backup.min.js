"use strict";var dialogBackup=void 0,dialogRestore=void 0,backupStateCheck=function a(t){$.ajax({type:"GET",url:"/api/backup/create/state",data:{id:t},cache:!1}).done(function(e){if(e&&1===e.status&&e.state)if(3===e.state||0===e.state)switch(e.state){case 0:dialogBackup.hide(),$zUI.notification(lang["Could not create backup file. Please check logs for details."],{status:"danger",timeout:1500});break;default:$("#dialogBackupWait").hide(),$("#dialogBackupDownload").show(),$("#dialogBackupButtons").show(),$("#dialogBackupDownloadLink").html('<a href="/backup/static/storage/backup_'+t+'.tgz">backup_'+t+".tar.gz</a>")}else setTimeout(function(){a(t)},5e3);else dialogBackup.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})}).fail(function(){dialogBackup.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})})},restoreStateCheck=function a(t){$.ajax({type:"GET",url:"/api/backup/restore/state",data:{id:t},cache:!1}).done(function(e){if(e&&1===e.status&&e.state)if(3===e.state||0===e.state)switch(e.state){case 0:$("#dialogRestoreBody").show(),$("#dialogRestoreSpinner").hide(),$("#dialogRestoreFooter").show(),$zUI.notification(lang["Could not restore backup file. Please check logs for details."],{status:"danger",timeout:1500});break;default:$("#dialogRestoreRestart").show(),$("#dialogRestoreSpinner").hide(),setTimeout(function(){$("#dialogRestoreRestart").hide(),$("#dialogRestoreSuccess").show()},3e4)}else setTimeout(function(){a(t)},5e3);else dialogRestore.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})}).fail(function(){dialogRestore.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})})},backupStart=function(){$("#zoia_btn_backup").hasClass("za-disabled")||($("#zoia_btn_backup").addClass("za-disabled"),$("#zoiaSpinnerMain").show(),$.ajax({type:"GET",url:"/api/backup/create",cache:!1}).done(function(a){$("#zoia_btn_backup").removeClass("za-disabled"),$("#zoiaSpinnerMain").hide(),a&&1===a.status&&a.taskId?($("#dialogBackupWait").show(),$("#dialogBackupDownload").hide(),$("#dialogBackupButtons").hide(),dialogBackup.show(),setTimeout(function(){backupStateCheck(a.taskId)},1500)):($("#zoia_btn_backup").removeClass("za-disabled"),$("#zoiaSpinnerMain").hide(),$zUI.notification(lang["Could not create backup file"],{status:"danger",timeout:1500}))}).fail(function(){$("#zoia_btn_backup").removeClass("za-disabled"),$("#zoiaSpinnerMain").hide(),$zUI.notification(lang["Could not create backup file"],{status:"danger",timeout:1500})},200))},initUploader=function(){var a=document.getElementById("bimport_progressbar");a.setAttribute("hidden","hidden"),$zUI.upload(".bimport-upload",{url:"/api/backup/restore",multiple:!1,error:function(){$zUI.notification(lang["Could not upload file"],{status:"danger",timeout:1500})},loadStart:function(t){a.removeAttribute("hidden"),$("#dialogRestoreFooter").hide(),a.max=t.total,a.value=t.loaded},progress:function(t){a.max=t.total,a.value=t.loaded},loadEnd:function(t){a.max=t.total,a.value=t.loaded},completeAll:function(){setTimeout(function(){a.setAttribute("hidden","hidden")},1e3);var t={};try{t=JSON.parse(arguments[0].response)}catch(a){}t.taskId?($("#dialogRestoreBody").hide(),$("#dialogRestoreSpinner").show(),setTimeout(function(){restoreStateCheck(t.taskId)},1500)):($("#dialogRestoreFooter").show(),$zUI.notification(lang["Could not upload file"],{status:"danger",timeout:1500}))}})};$(document).ready(function(){initUploader(),$("#zoia_btn_backup").click(backupStart),$("#zoia_btn_restore").click(function(){$("#dialogRestoreFooter").show(),$("#dialogRestoreBody").show(),$("#dialogRestoreSpinner").hide(),dialogRestore.show()}),dialogBackup=$zUI.modal("#dialogBackup",{bgClose:!1,escClose:!1}),dialogRestore=$zUI.modal("#dialogRestore",{bgClose:!1,escClose:!1})});