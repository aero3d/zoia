"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:{bullet}</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}{html}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslistItemFixed:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right">{key}</div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:{bullet}</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom {prefix}-formBuilder-valueslist-wrap">{items}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:120%">&#8226;</span>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match",parameter:"Parameter",value:"Value"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"uk-form-danger"},i=function(i,a){this.element=i,this.settings=e.extend({},t,a),this._defaults=t,this._name="zoiaFormBuilder",this._prefix=this.element.id,this._formTypes=["text","email","password","select","passwordConfirm","captcha","launcher","textarea","checkboxlist","valueslist","valueslistfixed","valueslisteditable"],this._saving=!1,this.init()};e.extend(i.prototype,{init:function(){var t="",i="";for(var a in this.settings.items){var s=this.settings.items[a],l="";switch((s.validation&&!this.settings.edit&&s.validation.mandatoryCreate||s.validation&&this.settings.edit&&s.validation.mandatoryEdit)&&(l=this.settings.html.bullet),s.type){case"text":case"email":case"password":t+=this._template(this.settings.html.text,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type});break;case"launcher":t+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:a,label:s.label,bullet:l,labelBtn:s.labelBtn,data:s.data,value:s.value,css:s.css?" "+s.css:"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",html:s.html?" "+s.html:""});break;case"valueslist":var n="";for(var r in s.values)n+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:a,key:s.values[r].p,value:s.values[r].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:a,label:s.label,bullet:l,items:n});break;case"valueslisteditable":var o="";for(var d in s.values)o+=this._template(this.settings.html.valueslistItemEditable,{prefix:this._prefix,name:a,key:s.values[d].p,value:s.values[d].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslistEditable,{prefix:this._prefix,name:a,label:s.label,bullet:l,items:o,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",buttons:s.buttons||""});break;case"valueslistfixed":var u="";for(var p in s.values)u+=this._template(this.settings.html.valueslistItemFixed,{prefix:this._prefix,name:a,key:s.values[p].p,value:s.values[p].t,data:s.values[p].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslistFixed,{prefix:this._prefix,name:a,label:s.label,bullet:l,items:u});break;case"select":var c="";for(var h in s.values)c+='<option value="'+h+'">'+s.values[h]+"</option>";t+=this._template(this.settings.html.select,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type,values:c});break;case"checkboxlist":var f="";for(var m in s.values)f+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:a,title:s.values[m]});t+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",items:f});break;case"passwordConfirm":t+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":t+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:a,css:s.css?" "+s.css:"",label:s.label,bullet:l,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",autofocus:s.autofocus?"autofocus":""});break;case"textarea":t+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):""});break;case"buttons":for(var v="",g=0;g<s.buttons.length;g++){var x=s.buttons[g];v+=this._template(this.settings.html.button,{css:x.css?" "+x.css:"",prefix:this._prefix,name:x.name||"button"+g,type:x.type||"button",label:x.label||""})+"&nbsp;"}i+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:s.css?" "+s.css:"",buttons:v,html:s.html?" "+s.html:""})}}e(this.element).html(this._template(this.settings.template.fields,{fields:t})+this._template(this.settings.template.buttons,{buttons:i})),e(".formBuilder-valueslist-btnAdd").unbind(),e(".formBuilder-valueslist-btnAdd").click(function(t){b._valueslistAddFunc(e(this).attr("data-prefix"),e(this).attr("data-name"),"","")}),e(".formBuilder-valueslist-btnDel").unbind(),e(".formBuilder-valueslist-btnDel").click(function(t){e(this).parent().parent().remove()}),e(".formBuilder-valueslistfixed-btnAdd").unbind(),e(".formBuilder-valueslistfixed-btnAdd").click(function(t){b._valueslistfixedAddFunc(e(this).attr("data-prefix"),e(this).attr("data-name"),"","")}),e(".formBuilder-valueslistfixed-btnDel").unbind(),e(".formBuilder-valueslistfixed-btnDel").click(function(t){e(this).parent().parent().remove()}),e(".formBuilder-valueslisteditable-btnAdd").unbind(),e(".formBuilder-valueslisteditable-btnAdd").click(function(t){b._valueslistAddFunc(e(this).attr("data-prefix"),e(this).attr("data-name"),"","")}),e(".formBuilder-valueslisteditable-btnDel").unbind(),e(".formBuilder-valueslisteditable-btnDel").click(function(t){e(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var b=this;e(this.element).submit(function(e){e.preventDefault(),b._submit()}),this._captchaInit()},_valueslistAddFunc:function(t,i,a,s,l){var n=this._template(this.settings.html.valueslistItem,{prefix:t,name:i,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e("#"+t+"_"+i+"_wrap").append(n),l||e("."+t+"-"+i+"-item").last().find("div>input:first").focus(),e(".formBuilder-valueslist-btnDel").unbind(),e(".formBuilder-valueslist-btnDel").click(function(t){t.stopPropagation(),e(this).parent().parent().remove()})},_valueslisteditableAddFunc:function(t,i,a,s,l,n){if(a){var r=this._template(this.settings.html.valueslistItemEditable,{prefix:t,name:i,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,data:l,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e("#"+t+"_"+i+"_wrap").append(r),n||e("."+t+"-"+i+"-item").last().find("div>input:first").focus(),e(".formBuilder-valueslisteditable-btnDel").unbind(),e(".formBuilder-valueslisteditable-btnDel").click(function(t){t.stopPropagation(),e(this).parent().parent().remove()})}},_valueslistfixedAddFunc:function(t,i,a,s,l){var n=this._template(this.settings.html.valueslistfixedItem,{prefix:t,name:i,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e("#"+t+"_"+i+"_wrap").append(n),l||e("."+t+"-"+i+"-item").last().find("div>input:first").focus(),e(".formBuilder-valueslistfixed-btnDel").unbind(),e(".formBuilder-valueslistfixed-btnDel").click(function(t){t.stopPropagation(),e(this).parent().parent().remove()})},setValidation:function(e){this.validation=e},setEditMode:function(e){this.settings.edit=e},clearErrors:function(){e("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),e("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors();e("."+this._prefix+"-form-field").not(".zoiaFormBuilder-no-reset").val(""),e("select."+this._prefix+"-form-field").prop("selectedIndex",0),e(".formBuilder-valueslist-val").val(""),e("."+this._prefix+"-formBuilder-valueslist-wrap").html("");for(var t in this.settings.items){var i=this.settings.items[t];i.default&&e("#"+this._prefix+"_"+t).val(i.default),"launcher"===i.type&&(e("#"+this._prefix+"_"+t+"_val").html(i.value),e("#"+this._prefix+"_"+t+"_val").attr("data",i.data)),"checkboxlist"===i.type&&e("."+this._prefix+"-"+t+"-cbx").prop("checked",!1)}},serialize:function(){var t=this,i={};for(var a in this.settings.items){var s=this.settings.items[a];-1!==this._formTypes.indexOf(s.type)&&function(){switch(s.type){case"launcher":i[a]={type:s.type,value:e("#"+t._prefix+"_"+a+"_val").html(),id:e("#"+t._prefix+"_"+a+"_val").attr("data")};break;case"checkboxlist":var l=e("."+t._prefix+"-"+a+"-cbx:checked").map(function(){return e(this).attr("data")}).get();i[a]={type:s.type,value:l.join(",")};break;case"valueslist":var n=[];e("."+t._prefix+"-"+a+"-item").each(function(){n.push({p:String(e(this).find("*>.formBuilder-valueslist-par").val()),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),i[a]={type:s.type,value:n};break;case"valueslisteditable":var r=[];e("."+t._prefix+"-"+a+"-item").each(function(){r.push({p:String(e(this).find("*>.formBuilder-valueslist-par").html()),v:String(e(this).find("*>.formBuilder-valueslist-val").val()),d:String(e(this).find("*>.formBuilder-valueslist-val").attr("data"))})}),i[a]={type:s.type,value:r};break;case"valueslistfixed":var o=[];e("."+t._prefix+"-"+a+"-item").each(function(){o.push({p:String(e(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),i[a]={type:s.type,value:o};break;default:i[a]={type:s.type,value:e("#"+t._prefix+"_"+a).val()}}}()}return i},deserialize:function(t){if(t&&"object"===(void 0===t?"undefined":_typeof(t)))for(var i in this.settings.items)switch(t[i]||(t[i]={id:"",value:""}),t[i].type){case"launcher":e("#"+this._prefix+"_"+i+"_val").html(t[i].value),e("#"+this._prefix+"_"+i+"_val").attr("data",t[i].id);break;case"checkboxlist":var a=t[i].value.split(",");for(var s in a)e('.editForm-groups-cbx[data="'+a[s]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var n in t[i].value)l.push(t[i].value[n].p),l.push(t[i].value[n].v);for(e("#"+this._prefix+"_"+i+"_wrap").html("");l.length>0;){var r=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,i,r,o,!0)}break;case"valueslisteditable":var d=[];for(var u in t[i].value)d.push(t[i].value[u].p),d.push(t[i].value[u].v),d.push(t[i].value[u].d);for(e("#"+this._prefix+"_"+i+"_wrap").html("");d.length>0;){var p=d.shift(),c=d.shift(),h=d.shift();this._valueslisteditableAddFunc(this._prefix,i,p,c,h,!0)}break;case"valueslistfixed":e("."+this._prefix+"-"+i+"-item-val").val("");for(var f in t[i].value)e("."+this._prefix+"-"+i+'-item-val[data="'+t[i].value[f].p+'"]').val(t[i].value[f].v);break;default:e("#"+this._prefix+"_"+i).val(t[i].value||"")}},deserializePart:function(t,i){if(i&&"object"===(void 0===i?"undefined":_typeof(i)))switch(i||(i={id:"",value:""}),i.type){case"launcher":e("#"+this._prefix+"_"+t+"_val").html(i.value),e("#"+this._prefix+"_"+t+"_val").attr("data",i.id);break;case"checkboxlist":var a=i.value.split(",");for(var s in a)e('.editForm-groups-cbx[data="'+a[s]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var n in i.value)l.push(i.value[n].p),l.push(i.value[n].v);for(e("#"+this._prefix+"_"+t+"_wrap").html("");l.length>0;){var r=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,t,r,o,!0)}break;case"valueslisteditable":var d=[];for(var u in i.value)d.push(i.value[u].p),d.push(i.value[u].v),d.push(i.value[u].d);for(e("#"+this._prefix+"_"+t+"_wrap").html("");d.length>0;){var p=d.shift(),c=d.shift(),h=d.shift();this._valueslisteditableAddFunc(this._prefix,t,p,c,h,!0)}break;case"valueslistfixed":e("."+this._prefix+"-"+t+"-item-val").val("");for(var f in i.value)e("."+this._prefix+"-"+t+'-item-val[data="'+i.value[f].p+'"]').val(i.value[f].v);break;default:e("#"+this._prefix+"_"+t).val(i.value||"")}},loadJSON:function(t){var i=this,a=this;jQuery.each(t,function(t,s){if(e("#"+a._prefix+"_"+t).val(s),a.settings.items[t]&&"checkboxlist"===a.settings.items[t].type&&s){var l=s.split(",");for(var n in l)e('.editForm-groups-cbx[data="'+l[n]+'"]').prop("checked",!0)}if(a.settings.items[t]&&"valueslist"===a.settings.items[t].type&&s){var r=[];for(var o in s)r.push(o),r.push(s[o]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var d in s)a._valueslistAddFunc(a._prefix,t,r.shift(),r.shift())}if(a.settings.items[t]&&"valueslisteditable"===a.settings.items[t].type&&s){console("value: "+s);var u=[];for(var p in s)u.push(p),u.push(s[p]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var c in s)a._valueslisteditableAddFunc(a._prefix,t,u.shift(),u.shift(),u.shift())}if(a.settings.items[t]&&"valueslistfixed"===a.settings.items[t].type&&s){e("."+i._prefix+"-"+t+"-item-val").val("");for(var h in s)e("."+i._prefix+"-"+t+'-item-val[data="'+s[h].p+'"]').val(s[h].v)}})},loadData:function(t){var i=this;this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var a=this;e.ajax({type:this.settings.load.method,url:this.settings.load.url,data:t,cache:!1}).done(function(t){t&&1===t.status?(jQuery.each(t.item,function(t,s){if(e("#"+a._prefix+"_"+t).val(s),a.settings.items[t]&&"checkboxlist"===a.settings.items[t].type&&s){var l=s.split(",");for(var n in l)e('.editForm-groups-cbx[data="'+l[n]+'"]').prop("checked",!0)}if(a.settings.items[t]&&"valueslist"===a.settings.items[t].type&&s){var r=[];for(var o in s)r.push(o),r.push(s[o]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var d in s)a._valueslistAddFunc(a._prefix,t,r.shift(),r.shift())}if(a.settings.items[t]&&"valueslisteditable"===a.settings.items[t].type&&s){var u=[];for(var p in s)u.push(p),u.push(s[p]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var c in s)a._valueslisteditableAddFunc(a._prefix,t,u.shift(),u.shift())}if(a.settings.items[t]&&"valueslistfixed"===a.settings.items[t].type&&s){e("."+i._prefix+"-"+t+"-item-val").val("");for(var h in s)e("."+i._prefix+"-"+t+'-item-val[data="'+s[h].p+'"]').val(s[h].v)}}),a.settings.events.onLoadSuccess&&a.settings.events.onLoadSuccess(t)):a.settings.events.onLoadError&&a.settings.events.onLoadError(t)}).fail(function(e,t){a.settings.events.onLoadError&&a.settings.events.onLoadError(e,t)})},captchaRefresh:function(){e("."+this._prefix+"-captcha-img").show(),e("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),e("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var t=this;e("img."+this._prefix+"-captcha-img").click(function(){t.captchaRefresh()})},_template:function(e,t){for(var i in t)e=e.replace(new RegExp("{"+i+"}","g"),t[i]);return e},validate:function(t){var i=this,a={},s={};for(var l in this.settings.items){var n=this.settings.items[l];if(-1!==this._formTypes.indexOf(n.type))if("launcher"!==n.type){if(("valueslist"!==n.type||"continue"!==function(){if(t&&t[l])return s[l]=t[l].value,"continue";var a=[];return e("."+i._prefix+"-"+l+"-item").each(function(){a.push({p:String(e(this).find("*>.formBuilder-valueslist-par").val()),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=a,"continue"}())&&!("valueslisteditable"===n.type&&"continue"===function(){if(t&&t[l])return s[l]=t[l].value,"continue";var a=[];return e("."+i._prefix+"-"+l+"-item").each(function(){a.push({p:String(e(this).find("*>.formBuilder-valueslist-par").val()),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=a,"continue"}()||"valueslistfixed"===n.type&&"continue"===function(){if(t&&t[l])return s[l]=t[l].value,"continue";var a=[];return e("."+i._prefix+"-"+l+"-item").each(function(){a.push({p:String(e(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=a,"continue"}()))if("checkboxlist"!==n.type){var r=t?t[l]?t[l].value:void 0:e("#"+this._prefix+"_"+l).val();if(n.validation){if(!n.validation.mandatoryEdit&&!r&&this.settings.edit||!n.validation.mandatoryCreate&&!r&&!this.settings.edit)continue;if(n.validation.mandatoryCreate&&!r&&!this.settings.edit){a[l]=this.settings.lang.mandatoryMissing;continue}if(n.validation.mandatoryEdit&&!r&&this.settings.edit){a[l]=this.settings.lang.mandatoryMissing;continue}if(n.validation.process&&"function"==typeof n.validation.process&&(r=n.validation.process(r)),"passwordConfirm"===n.type&&e("#"+this._prefix+"_"+l+"Confirm").val()!==r){a[l]=this.settings.lang.passwordsNotMatch;continue}if(n.validation.length){if(n.validation.length.min&&r.length<n.validation.length.min){a[l]=this.settings.lang.tooShort;continue}if(n.validation.length.max&&r.length>n.validation.length.max){a[l]=this.settings.lang.tooLong;continue}}if(n.validation.regexp&&!r.match(n.validation.regexp)){a[l]=this.settings.lang.invalidFormat;continue}s[l]=r}}else{var o=e("."+this._prefix+"-"+l+"-cbx:checked").map(function(){return e(this).attr("data")}).get();s[l]=t?t[l]?t[l].value:void 0:o.join(",")}}else s[l]=t?t[l]?t[l].id:void 0:e("#"+this._prefix+"_"+l+"_val").attr("data")}return{data:s,errors:a}},errors:function(t){if(Object.keys(t).length>0){var i=!1;for(var a in t)e("#"+this._prefix+"_"+a).addClass(this.settings.formDangerClass),e("#"+this._prefix+"_"+a+"_error_text > span").html(t[a]),e("#"+this._prefix+"_"+a+"_error_text").show(),i||(e("#"+this._prefix+"_"+a).focus(),i=!0),"passwordConfirm"===this.settings.items[a].type&&e("#"+this._prefix+"_"+a+"Confirm").addClass(this.settings.formDangerClass);return!0}return!1},_submit:function(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var t=this,i={},a={};if(this.settings.validation){var s=this.validate();if(i=s.data||{},a=s.errors||{},this.errors(a))return;if(this.settings.events.onSaveValidate&&"__stop"===(i=this.settings.events.onSaveValidate(i,a)||i))return}else if(this.settings.events.onSaveValidate&&"__stop"===(i=this.settings.events.onSaveValidate(i)))return;t._saving=!0,e.ajax({type:this.settings.save.method,url:this.settings.save.url,data:i,cache:!1}).done(function(i){if(t._saving=!1,i&&1===i.status)t.settings.events.onSaveSuccess&&t.settings.events.onSaveSuccess(i);else{if(i.fields)for(var a in i.fields){var s=!1;e("#"+t._prefix+"_"+i.fields[a]).addClass(t.settings.formDangerClass),s||(e("#"+t._prefix+"_"+i.fields[a]).focus(),s=!0)}t.captchaRefresh(),t.settings.events.onSaveError&&t.settings.events.onSaveError(i)}}).fail(function(e,i){t._saving=!1,t.captchaRefresh(),t.settings.events.onSaveError&&t.settings.events.onSaveError(e,i)})}}}),e.fn.zoiaFormBuilder=function(t){var a=void 0;return this.each(function(){(a=e.data(this,"plugin_zoiaFormBuilder"))||(a=new i(this,t),e.data(this,"plugin_zoiaFormBuilder",a))}),a}}(jQuery,window,document),function(e){function t(t,s){this.element=t,this.settings=e.extend({},a,s),this._defaults=a,this._name=i,this.page=1,this.loading=!1,this.search="",this.currentData={},this.init()}var i="zoiaTable",a={limit:10,maxPages:7,html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:"background:#fff;position:absolute;opacity:0.6",headCSS:"@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}",listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:"</ul>",itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:"&nbsp;&#x25BC;",arrowUp:"&nbsp;&#x25B2;",errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:"Could not load data from server. Please try to refresh page in a few moments.",noitems:"No items to display"},sort:{},loadOnStart:!0,onLoad:function(){}};e.extend(t.prototype,{init:function(){var t=this;e("head").append('<style type="text/css">'+this.settings.html.headCSS+"</style>"),e(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+"</div>"),this._loading(!1),this.header=[];for(var i=0;i<e("#"+this.element.id+" > thead > tr").children("th").length;i++){var a=e("#"+this.element.id+" > thead > tr").children("th")[i];if(a.id){this.header.push(a.id);var s=a.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.fields[s]&&this.settings.fields[s].sortable&&(e(a).css("cursor","pointer"),e(a).click(function(e){t._sortColumn(e)}))}}e("."+this.element.id+"SearchInput").keypress(t._debounce(function(e){t._search(e)},250)),e("."+this.element.id+"SearchInputClear").click(function(e){t._searchReset(e)}),this.settings.loadOnStart&&this.load()},_search:function(t){this.loading||(this.search=e(t.target).val().trim(),this.page=1,this.load())},_searchReset:function(){this.loading||(e("."+this.element.id+"SearchInput").val("").focus(),this.search="",this.page=1,this.load())},_sortIndicator:function(t,i){e("#"+this.element.id+"SortingIndicator").remove();for(var a="desc"===i?this.settings.html.arrowDown:this.settings.html.arrowUp,s=0;s<e("#"+this.element.id+" > thead > tr").children("th").length;s++){var l=e("#"+this.element.id+" > thead > tr").children("th")[s];l.id===this.element.id+"_"+t&&e(l).html(e(l).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+a+"</span>")}},_sortColumn:function(e){if(e.preventDefault(),e.target.id&&e.target.id!==this.element.id+"SortingIndicator"){var t=e.target.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.sort.field===t?this.settings.sort.direction="asc"===this.settings.sort.direction?"desc":"asc":(this.settings.sort.field=t,this.settings.sort.direction="asc"),this.load()}},_template:function(e,t){for(var i in t)e=e.replace(new RegExp("{"+i+"}","g"),t[i]);return e},_bindSelectButtons:function(){var t=this;e("."+this.element.id+"BtnSelectAll").click(function(){t._selectAll()}),e("."+this.element.id+"BtnSelectNone").click(function(){t._selectNone()})},_selectAll:function(){this.loading||e("."+this.element.id+"Checkbox").prop("checked",!0)},_selectNone:function(){this.loading||e("."+this.element.id+"Checkbox").prop("checked",!1)},_pagination:function(){var t=this,i=this.settings.maxPages,a=Math.ceil(this.total/this.settings.limit);if(a<2)e("."+this.element.id+"Pagination").html("");else{var s=this.settings.html.listWrapStartHTML;if(a>i){this.page>1&&(s+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),this.page>3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var l=this.page-2;l<1&&(l=1),l-1>1&&(s+=this.settings.html.itemPageDotsHTML);var n=this.page+2;n>a&&(n=a);for(var r=l;r<=n;r++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:r});n<a-1&&(s+=this.settings.html.itemPageDotsHTML),this.page<=a-3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:a})),this.page<a&&(s+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var o=1;o<=a;o++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:o});s+=this.settings.html.listWrapEndHTML,e("."+this.element.id+"Pagination").html(s),e("."+this.element.id+"PaginationLink").click(function(){var i=parseInt(e(this).data("page"),10);t.loading||t.page===i||(t.page=i,t.load())})}},_loading:function(t){var i="#"+this.element.id+"LoadingDiv";e(i).css({top:e(this.element).top,left:e(this.element).left,width:e(this.element).outerWidth(!0),height:e(this.element).outerHeight(!0)}),t?this.loadingInt=setTimeout(function(){e(i).show()},300):(clearTimeout(this.loadingInt),e(i).hide())},_debounce:function(e,t){var i=null;return function(){var a=this,s=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(a,s)},t)}},getCurrentData:function(){return this.currentData},load:function(){if(this.settings.url&&!this.loading){var t=this,i="";this._loading(!0),this.loading=!0,e.ajax({type:"GET",url:this.settings.url,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(a){if(t.loading=!1,a){t.pages=parseInt(a.total/t.settings.limit,10),a.total%t.settings.limit>0&&t.pages++,t.total=a.total,t._pagination(),t.currentData={};for(var s in a.items){var l=a.items[s];t.currentData[l._id]=l,i+="<tr>";for(var n in t.header)if(t.header[n]===t.element.id+"ID")i+='<td><input type="checkbox" id="'+l._id+'" class="za-checkbox '+t.element.id+'Checkbox"></td>';else{var r=!1,o=t.header[n].replace(new RegExp("^"+t.element.id+"_"),"");for(var d in l)d===o&&t.settings.fields[d]&&(l[d]&&"string"==typeof l[d]&&(l[d]=l[d].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),i+="<td>"+t.settings.fields[d].process(d,l,l[d])+"</td>",r=!0);r||(t.settings.fields[o]&&t.settings.fields[o].process?i+="<td>"+t.settings.fields[o].process(o,l)+"</td>":i+="<td></td>")}i+="</tr>"}e(t.element).find("tbody").html(i.length?i:t._template(t.settings.html.errorHTML,{error:t.settings.lang.noitems})),t._loading(!1),e('*[data-page="'+t.page+'"]').parent().addClass("za-active"),t._bindSelectButtons(),t.settings.sort.field&&t._sortIndicator(t.settings.sort.field,t.settings.sort.direction),e(t.element).find("thead").show(),t.settings.onLoad()}else t.loading=!1,t._loading(!1),e(t.element).find("tbody").html(t._template(t.settings.html.errorHTML,{error:t.settings.lang.error}))}).fail(function(){t.loading=!1,t._loading(!1),e(t.element).find("tbody").html(t._template(t.settings.html.errorHTML,{error:t.settings.lang.error}))})}}}),e.fn[i]=function(a){var s=void 0;return this.each(function(){(s=e.data(this,"plugin_"+i))||(s=new t(this,a),e.data(this,"plugin_"+i,s))}),s}}(jQuery,window,document);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},editDialog=void 0,deleteDialog=void 0,currentEditID=void 0,currentDeleteID=void 0,getUrlParam=function(e){var t=decodeURIComponent(window.location.search.substring(1)).split("&"),i=void 0,a=void 0;for(a=0;a<t.length;a++)if((i=t[a].split("="))[0]===e)return void 0===i[1]||i[1]},setZoiaEditHeader=function(e){e?$("#editDialogHeader").html(lang.editItem):$("#editDialogHeader").html(lang.addItem)},editFormSpinner=function(e){e?($(".editForm-form-button").hide(),$("#zoiaEditDialogSpinner").show()):($(".editForm-form-button").show(),$("#zoiaEditDialogSpinner").hide())},editDialogSpinner=function(e){e?($("#zoiaEditDialogLoading").show(),$("#zoiaEditDialogForm").hide()):($("#zoiaEditDialogLoading").hide(),$("#zoiaEditDialogForm").show())},deleteDialogSpinner=function(e){e?($(".zoia-delete-dialog-button").hide(),$("#zoiaDeleteDialogSpinner").show()):($(".zoia-delete-dialog-button").show(),$("#zoiaDeleteDialogSpinner").hide())},createItem=function(){$("#editForm").zoiaFormBuilder().setEditMode(!1),$("#editForm").zoiaFormBuilder().resetForm(!1),currentEditID=null,setZoiaEditHeader(!1),editDialogSpinner(!1),editFormSpinner(!1),editDialog.show(),$("#editUser_username").focus()},showTable=function(){editDialog.hide(),$("#users").zoiaTable().load()},editItem=function(e){if(!e||"string"!=typeof e||!e.match(/^[a-f0-9]{24}$/))return showTable();currentEditID=e,setZoiaEditHeader(!0),$("#editForm").zoiaFormBuilder().setEditMode(!0),$("#editForm").zoiaFormBuilder().resetForm(!1),editDialogSpinner(!0),editFormSpinner(!1),$("#editForm").zoiaFormBuilder().loadData({id:e}),editDialog.show()},deleteItem=function(e){if(!e)return showTable();var t=[],i=[];if(currentDeleteID=[],"object"===(void 0===e?"undefined":_typeof(e))){t=e,currentDeleteID=e;for(var a in e)i.push($("#users").zoiaTable().getCurrentData()[e[a]].username)}else t.push(e),currentDeleteID.push(e),i.push($("#users").zoiaTable().getCurrentData()[e].username);$("#zoiaDeleteDialogList").html("");for(var s in i)$("#zoiaDeleteDialogList").append("<li>"+i[s]+"</li>");deleteDialogSpinner(!1),deleteDialog.show()},ajaxDeleteItem=function(){deleteDialogSpinner(!0),$.ajax({type:"POST",url:"/api/users/delete",data:{id:currentDeleteID},cache:!1}).done(function(e){$("#users").zoiaTable().load(),e&&1===e.status?(deleteDialog.hide(),$zUI.notification(lang["Operation was successful"],{status:"success",timeout:1500})):($zUI.notification(lang["Cannot delete one or more items"],{status:"danger",timeout:1500}),deleteDialogSpinner(!1))}).fail(function(){$("#users").zoiaTable().load(),$zUI.notification(lang["Cannot delete one or more items"],{status:"danger",timeout:1500}),deleteDialogSpinner(!1)})},processState=function(e){var t=e||{action:getUrlParam("action"),id:getUrlParam("id")};switch(t.action){case"edit":editItem(t.id);break;case"create":createItem();break;default:showTable()}};$(document).ready(function(){editDialog=$zUI.modal("#zoiaEditDialog",{bgClose:!1,escClose:!1}),deleteDialog=$zUI.modal("#zoiaDeleteDialog",{bgClose:!1,escClose:!1}),$(".zoiaDeleteButton").click(function(){var e=$(".usersCheckbox:checkbox:checked").map(function(){return this.id}).get();e&&e.length>0&&deleteItem(e)}),$("#zoiaDeleteDialogButton").click(function(){ajaxDeleteItem()}),$("#editForm").zoiaFormBuilder({save:{url:"/api/users/save",method:"POST"},load:{url:"/api/users/load",method:"GET"},template:{fields:'<div class="za-modal-body">{fields}</div>',buttons:"{buttons}"},formDangerClass:"za-form-danger",html:{helpText:'<div class="za-text-meta">{text}</div>',text:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><input class="za-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',select:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><select{multiple} class="za-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-flex"><div class="{prefix}-field-wrap"><input class="za-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="za-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',captcha:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-grid za-grid-small"><div><input class="za-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="za-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="za-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}_btn">{label}:</label><div class="za-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="za-button za-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}</div>',textarea:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><textarea class="za-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="za-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-panel za-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="za-list">{items}</ul></div>{helpText}</div>'},events:{onSaveValidate:function(e){return editFormSpinner(!0),e.id=currentEditID,e},onSaveSuccess:function(){$("#editForm_groups_wrap").scrollTop(0),editDialog.hide(),$zUI.notification(lang.fieldErrors["Saved successfully"],{status:"success",timeout:1500}),$("#users").zoiaTable().load(),window.history.pushState({action:""},document.title,"/admin/users")},onSaveError:function(e){if(editFormSpinner(!1),e)switch(e.status){case-1:$zUI.notification(lang.fieldErrors["User not found"],{status:"danger",timeout:1500});break;case-2:$zUI.notification(lang.fieldErrors["Username already exists in database"],{status:"danger",timeout:1500});break;default:var t="";e.fields&&(t=". "+lang.fieldErrors["Fields failed"]+": "+e.fields.join(", ")),$zUI.notification(lang.fieldErrors["Could not save to the database"]+t,{status:"danger",timeout:1500})}},onLoadSuccess:function(){editDialogSpinner(!1),$("#editForm_username").focus()},onLoadError:function(){editDialog.hide(),$("#zoiaEditDialog").hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})}},items:{username:{type:"text",label:lang.Username,css:"za-form-width-medium",autofocus:!0,helpText:lang["Latin characters and numbers, length: 3-20"],validation:{mandatoryCreate:!0,mandatoryEdit:!0,length:{min:3,max:20},regexp:/^[A-Za-z0-9_\-]+$/,process:function(e){return e.trim().toLowerCase()}}},email:{type:"email",label:lang["E-mail"],css:"za-width-medium",helpText:lang["Example: user@domain.com"],validation:{mandatoryCreate:!0,mandatoryEdit:!0,length:{min:6,max:129},regexp:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,process:function(e){return e.trim().toLowerCase()}}},password:{type:"passwordConfirm",label:lang.Password,helpText:lang["Minimal length: 5 characters, type twice to verify"],validation:{mandatoryCreate:!0,mandatoryEdit:!1,length:{min:5,max:50},process:function(e){return e.trim()}}},groups:{type:"checkboxlist",label:lang.Groups,helpText:lang["A list of groups for user"],values:zoiaGroups},status:{type:"select",label:lang.Status,css:"za-form-width-small",values:{0:lang.statuses[0],1:lang.statuses[1]},default:"1",validation:{mandatoryCreate:!0,mandatoryEdit:!0,length:{min:1,max:1},regexp:/^(0|1)$/}},buttons:{type:"buttons",css:"za-modal-footer za-text-right",buttons:[{name:"btnCancel",label:lang.Cancel,css:"za-button-default za-modal-close"},{name:"btnSave",label:lang.Save,css:"za-button-primary",type:"submit"}],html:'<div za-spinner style="float:right;display:none" id="zoiaEditDialogSpinner"></div>'}},lang:{mandatoryMissing:lang["Should not be empty"],tooShort:lang["Too short"],tooLong:lang["Too long"],invalidFormat:lang["Doesn't match required format"],passwordsNotMatch:lang["Passwords do not match"]}}),$("#users").zoiaTable({url:"/api/users/list",limit:20,sort:{field:"username",direction:"asc"},fields:{username:{sortable:!0,process:function(e,t,i){return i}},email:{sortable:!0,process:function(e,t,i){return i}},status:{sortable:!0,process:function(e,t,i){return lang.statuses[i]||"&ndash;"}},groups:{sortable:!0,process:function(e,t,i){if(!i)return"&ndash;";var a=i.replace(/,/gm,", ");return a.length<=50?a:a.substr(0,a.lastIndexOf(", ",50))+" ("+lang["and some more"]+")"}},actions:{sortable:!1,process:function(e,t){return'<button class="za-icon-button zoia-users-action-edit-btn" za-icon="icon: pencil" data="'+t._id+'" style="margin-right:5px"></button><button class="za-icon-button zoia-users-action-del-btn" za-icon="icon: trash" data="'+t._id+'"></button><div style="margin-bottom:17px" class="za-hidden@m">&nbsp;</div>'}}},onLoad:function(){$(".zoia-users-action-edit-btn").click(function(){window.history.pushState({action:"edit",id:$(this).attr("data")},document.title,"/admin/users?action=edit&id="+$(this).attr("data")),editItem($(this).attr("data"))}),$(".zoia-users-action-del-btn").click(function(){deleteItem($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}}),$("#editForm_btnCancel").click(function(){window.history.pushState({action:""},document.title,"/admin/users"),$("#editForm_groups_wrap").scrollTop(0)}),$(".zoiaAdd").click(function(){window.history.pushState({action:"create"},document.title,"/admin/users?action=create"),createItem()}),$(window).bind("popstate",function(e){processState(e.originalEvent.state)}),processState()});