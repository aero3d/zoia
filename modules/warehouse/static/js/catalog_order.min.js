"use strict";var totalWares=0,loading=!1,filterInput=function(){$(this).removeClass("za-form-danger");var a=$(this).attr("data-mask"),t=$(this).val().trim();if($(this).attr("data-mandatory")&&""===t)$(this).addClass("za-form-danger");else if(a){if(!$(this).attr("data-mandatory")&&""===t)return;new RegExp(a).test(t)||$(this).addClass("za-form-danger")}},submitOrder=function(a){if(a.preventDefault(),!loading){$("#za_catalog_order_form_error").hide(),$("#za_catalog_form_captcha_error_text").hide(),$(".za-catalog-form-input").removeClass("za-form-danger");var t=void 0,r=void 0,e={delivery:$("#za_catalog_order_delivery").val()};"delivery"===$("#za_catalog_order_delivery").find(":selected").attr("data-type")&&$(".za-catalog-order-form-rx").each(function(){var a=$(this).val().trim(),o=$(this).attr("data-mask");if($(this).attr("data-mandatory")&&""===a)return $(this).addClass("za-form-danger"),t=!0,void(r||(r=!0,$(this).focus()));if(o){if(!$(this).attr("data-mandatory")&&""===a)return;if(!new RegExp(o).test(a))return $(this).addClass("za-form-danger"),t=!0,void(r||(r=!0,$(this).focus()))}e[$(this).attr("id").replace("za_catalog_form_","")]=a}),isAuth||(e.captcha=$("#za_catalog_form_captcha").val().trim(),e.captcha&&e.captcha.match(/^([0-9]+){4}$/)||(t=!0,$("#za_catalog_form_captcha_error_text").show())),t?$("#za_catalog_order_form_error").show():(loading=!0,$(".za_catalog_order_submit_spinner").show(),$.ajax({type:"POST",url:"/api/warehouse/order",data:e,cache:!1}).done(function(a){if(loading=!1,$(".za_catalog_order_submit_spinner").hide(),1===a.status&&a.order)$("#za_catalog_order_wrap").hide(),$("#za_catalog_order_success_id").html(a.order._id),$("#za_catalog_order_success").show();else if(captchaRefresh(),a.fields){var t=!1;for(var r in a.fields)$("#za_catalog_form_"+a.fields[r]).addClass("za-form-danger"),"captcha"===a.fields[r]&&$("#za_catalog_form_captcha_error_text").show(),t||(t=!0,$("#za_catalog_form_"+a.fields[r]).focus());$zUI.notification(lang["Form contains errors"],{status:"danger",timeout:1500})}else $zUI.notification(lang["Could not place your order. Please try again later or contact website support."],{status:"danger",timeout:1500})}).fail(function(){loading=!1,$(".za_catalog_order_submit_spinner").hide(),captchaRefresh(),$zUI.notification(lang["Could not place your order. Please try again later or contact website support."],{status:"danger",timeout:1500})}))}},getAddressLabel=function(a){if("za_catalog_order_delivery"===a)return lang.Delivery;for(var t in addressJSON){var r=addressJSON[t];if(r.id===a)return r.label[locale]}return""},captchaRefresh=function(){$(".za-catalog-order-captcha-img").show(),$(".za-catalog-order-captcha-img").attr("src","/api/captcha?"+(new Date).getTime()),$("#za_catalog_form_captcha").val("")},captchaInit=function(){captchaRefresh(),$(".za-catalog-order-captcha-img").click(function(){captchaRefresh()})},calculateFields=function(){var a=totalWares,t={};"delivery"===$("#za_catalog_order_delivery").find(":selected").attr("data-type")&&$(".za-catalog-order-form-rx").each(function(){var r=$(this).attr("id").replace("za_catalog_form_",""),e=$(this).attr("data-cost")||parseFloat($(this).find(":selected").attr("data-cost"))||0,o=$(this).attr("data-addprc")||parseFloat($(this).find(":selected").attr("data-addprc"))||0,l=$(this).attr("data-weight")||parseFloat($(this).find(":selected").attr("data-weight"))||0;if(e||o||l){var c=0;e&&(c+=e),o&&(c+=totalWares/100*o),l&&(c+=l*weight),a+=parseFloat(c),t[getAddressLabel(r)]=parseFloat(c).toFixed(2)+"&nbsp;"+settings.currency}}),a=parseFloat(a).toFixed(2),$(".za-catalog-cart-extra").remove();var r="";for(var e in t)r+='<tr class="za-catalog-cart-extra"><td>'+e+'</td><td colspan="2"></td><td>'+t[e]+"</td></tr>";$("#za-catalog-cart-table").append(r),$(".za-catalog-cart-total").html(a+"&nbsp;"+settings.currency)},onDeliveryChange=function(){"delivery"===$("#za_catalog_order_delivery").find(":selected").attr("data-type")?$("#za_catalog_order_form").show():$("#za_catalog_order_form").hide(),$("#za_catalog_order_form_error").hide()};$(document).ready(function(){var a="";for(var t in addressJSON){var r=addressJSON[t];switch(r.type){case"text":a+='<div class="za-margin"><label class="za-form-label" for="za_catalog_form_'+r.id+'">'+r.label[locale]+": "+(r.mandatory?'<span class="za-text-danger za-text-bold">&nbsp;*</span>':"")+'</label><div class="za-form-controls"><input class="za-catalog-order-form-rx za-catalog-form-input za-input za-width-'+r.width+'" id="za_catalog_form_'+r.id+'" type="text" maxlength="'+r.maxlength+'" data-mask="'+(r.regex?r.regex:"")+'" data-mandatory="'+(r.mandatory?"true":"")+'"></div></div>';break;case"select":var e="";for(var o in r.values){var l=r.values[o];e+='<option value="'+l.value+'" data-addprc="'+l.addPrc+'" data-cost="'+l.cost+'">'+l.lang[locale]+"</option>"}a+='<div class="za-margin"><label class="za-form-label" for="za_catalog_form_'+r.id+'">'+r.label[locale]+':&nbsp;</label><div class="za-form-controls"><select class="za-catalog-form-input za-catalog-order-form-rx za-select za-width-'+r.width+'" id="za_catalog_form_'+r.id+'">'+e+"</select></div></div>"}}$("#za_catalog_order_form").html(a),$(".za-catalog-order-form-rx").on("input",filterInput),$("#za_catalog_form_captcha").on("input",filterInput),$(".za-catalog-order-form-rx").on("input",calculateFields),$("#za_catalog_order_submit").click(submitOrder),$("#za_catalog_order_delivery").on("input",onDeliveryChange),totalWares=parseFloat($(".za-catalog-cart-total").attr("data-total")),calculateFields(),onDeliveryChange(),captchaInit()});