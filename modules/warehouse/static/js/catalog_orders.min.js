"use strict";var _slicedToArray=function(){return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,a){var e=[],r=!0,s=!1,i=void 0;try{for(var o,n=t[Symbol.iterator]();!(r=(o=n.next()).done)&&(e.push(o.value),!a||e.length!==a);r=!0);}catch(t){s=!0,i=t}finally{try{!r&&n.return&&n.return()}finally{if(s)throw i}}return e}(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),getUrlParam=function(t){var a=decodeURIComponent(window.location.search.substring(1)).split("&"),e=void 0,r=void 0;for(r=0;r<a.length;r++)if((e=a[r].split("="))[0]===t)return void 0===e[1]||e[1]},processTemplate=function(t,a){for(var e in a)t=t.replace(new RegExp("{"+e+"}","g"),a[e]);return t=t.replace(new RegExp("({([^}]+)})","ig"),"")},processState=function(t){var a=t||{action:getUrlParam("action"),id:getUrlParam("id")};switch(a.action){case"view":viewOrder(a.id);break;default:$("#zoiaSpinnerMain").hide(),$("#wrapOrder").hide(),$("#wrapOrders").show()}},viewOrder=function(t){$("#zoiaSpinnerMain").show(),$("#orderID").html(t),$.ajax({type:"POST",url:"/api/warehouse/orders/load",data:{id:t},cache:!1}).done(function(t){if($("#zoiaSpinnerMain").hide(),1===t.status&&t.item){var a=t.item;$("#za_order_date").html(new Date(1e3*parseInt(a.date,10)).toLocaleString()),$("#za_order_status").html(lang.orderStatuses[a.status]),$("#za_order_delivery").html(deliveryData[a.delivery]);var e='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive"><tbody>';for(var r in a.cart){var s=r.split("|"),i=_slicedToArray(s,2),o=i[0],n=i[1],d="";for(var l in a.cart[r].checkboxes)t.propertiesData[a.cart[r].checkboxes[l]]&&(d+="<br>"+t.propertiesData[a.cart[r].checkboxes[l]]);for(var c in a.cart[r].integers){var p=a.cart[r].integers[c].split("|"),u=_slicedToArray(p,2),b=u[0],h=u[1];t.propertiesData[b]&&(d+="<br>"+t.propertiesData[b]+"&nbsp;("+h+")")}e+='<tr><td class="za-table-shrink">'+o+'</td><td class="za-table-expand">'+t.cartData[o]+(n?"&nbsp;("+t.variants[n]+")":"")+d+'</td><td class="za-table-shrink">'+a.cart[r].count+'</td><td class="za-table-shrink"></td></tr>'}e+="</tbody></table>",$("#za_order_cart").html(e);var f='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive" id="za_catalog_order_costs_table"><tbody>';f+='<tr><td class="za-table-expand">'+lang["Wares cost"]+'</td><td class="za-table-shrink">'+a.costs.totalWares+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>',f+='<tr><td class="za-table-expand">'+lang.Delivery+'</td><td class="za-table-shrink">'+a.costs.delivery+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>';for(var z in a.costs.extra)f+='<tr><td class="za-table-expand">'+t.addressData[z]+'</td><td class="za-table-shrink">'+a.costs.extra[z]+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>';f+='<tr><td class="za-table-expand">'+lang.Total+'</td><td class="za-table-shrink">'+a.costs.total+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>',f+="</tbody></table>",$("#za_order_costs").html(f);var v="";if("pickup"!==t.delivery.delivery){$(".za-catalog-metadata-wrap").addClass("za-grid-divider");for(var g in a.address)addressData[g]&&addressData[g][a.address[g]]&&(a.address[g]=addressData[g][a.address[g]]);v=processTemplate(addressTemplate.data,a.address)}else $(".za-catalog-metadata-wrap").removeClass("za-grid-divider");$("#za_order_address").html(v),$("#wrapOrders").hide(),$("#wrapOrder").show()}else window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})}).fail(function(){$("#zoiaSpinnerMain").hide(),window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})})},ordersTableData={url:"/api/warehouse/orders",limit:20,sort:{field:"_id",direction:"desc"},fields:{_id:{sortable:!0,process:function(t,a,e){return e}},date:{sortable:!0,process:function(t,a,e){return new Date(1e3*parseInt(e,10)).toLocaleString()}},costs:{sortable:!1,process:function(t,a,e){return e.total+"&nbsp;"+settings.currency}},status:{sortable:!0,process:function(t,a,e){return lang.orderStatuses[e]}},actions:{sortable:!1,process:function(t,a){return'<button class="za-icon-button zoia-order-view-btn" za-icon="icon:more" data="'+a._id+'" style="margin-right:5px"></button>'}}},onLoad:function(){$(".zoia-order-view-btn").unbind().click(function(){window.history.pushState({action:"view",id:$(this).attr("data")},document.title,"/catalog/orders?action=view&id="+$(this).attr("data")),viewOrder($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}};$(document).ready(function(){$("#orders").zoiaTable(ordersTableData),window.setTimeout(function(){$(window).bind("popstate",function(t){processState(t.originalEvent.state)}),processState()},0)});