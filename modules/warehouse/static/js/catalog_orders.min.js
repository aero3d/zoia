"use strict";!function(t){function e(e,s){this.element=e,this.settings=t.extend({},i,s),this._defaults=i,this._name=a,this.page=1,this.loading=!1,this.search="",this.currentData={},this.init()}var a="zoiaTable",i={limit:10,maxPages:7,html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:"background:#fff;position:absolute;opacity:0.6",headCSS:"@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}",listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:"</ul>",itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:"&nbsp;&#x25BC;",arrowUp:"&nbsp;&#x25B2;",errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:"Could not load data from server. Please try to refresh page in a few moments.",noitems:"No items to display"},sort:{},loadOnStart:!0,onLoad:function(){}};t.extend(e.prototype,{init:function(){var e=this;t("head").append('<style type="text/css">'+this.settings.html.headCSS+"</style>"),t(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+"</div>"),this._loading(!1),this.header=[];for(var a=0;a<t("#"+this.element.id+" > thead > tr").children("th").length;a++){var i=t("#"+this.element.id+" > thead > tr").children("th")[a];if(i.id){this.header.push(i.id);var s=i.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.fields[s]&&this.settings.fields[s].sortable&&(t(i).css("cursor","pointer"),t(i).click(function(t){e._sortColumn(t)}))}}t("."+this.element.id+"SearchInput").keypress(e._debounce(function(t){e._search(t)},250)),t("."+this.element.id+"SearchInputClear").click(function(t){e._searchReset(t)}),this.settings.loadOnStart&&this.load()},_search:function(e){this.loading||(this.search=t(e.target).val().trim(),this.page=1,this.load())},_searchReset:function(){this.loading||(t("."+this.element.id+"SearchInput").val("").focus(),this.search="",this.page=1,this.load())},_sortIndicator:function(e,a){t("#"+this.element.id+"SortingIndicator").remove();for(var i="desc"===a?this.settings.html.arrowDown:this.settings.html.arrowUp,s=0;s<t("#"+this.element.id+" > thead > tr").children("th").length;s++){var r=t("#"+this.element.id+" > thead > tr").children("th")[s];r.id===this.element.id+"_"+e&&t(r).html(t(r).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+i+"</span>")}},_sortColumn:function(t){if(t.preventDefault(),t.target.id&&t.target.id!==this.element.id+"SortingIndicator"){var e=t.target.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.sort.field===e?this.settings.sort.direction="asc"===this.settings.sort.direction?"desc":"asc":(this.settings.sort.field=e,this.settings.sort.direction="asc"),this.load()}},_template:function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t},_bindSelectButtons:function(){var e=this;t("."+this.element.id+"BtnSelectAll").click(function(){e._selectAll()}),t("."+this.element.id+"BtnSelectNone").click(function(){e._selectNone()})},_selectAll:function(){this.loading||t("."+this.element.id+"Checkbox").prop("checked",!0)},_selectNone:function(){this.loading||t("."+this.element.id+"Checkbox").prop("checked",!1)},_pagination:function(){var e=this,a=this.settings.maxPages,i=Math.ceil(this.total/this.settings.limit);if(i<2)t("."+this.element.id+"Pagination").html("");else{var s=this.settings.html.listWrapStartHTML;if(i>a){this.page>1&&(s+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),this.page>3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var r=this.page-2;r<1&&(r=1),r-1>1&&(s+=this.settings.html.itemPageDotsHTML);var n=this.page+2;n>i&&(n=i);for(var o=r;o<=n;o++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:o});n<i-1&&(s+=this.settings.html.itemPageDotsHTML),this.page<=i-3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:i})),this.page<i&&(s+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var d=1;d<=i;d++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:d});s+=this.settings.html.listWrapEndHTML,t("."+this.element.id+"Pagination").html(s),t("."+this.element.id+"PaginationLink").click(function(){var a=parseInt(t(this).data("page"),10);e.loading||e.page===a||(e.page=a,e.load())})}},_loading:function(e){var a="#"+this.element.id+"LoadingDiv";t(a).css({top:t(this.element).top,left:t(this.element).left,width:t(this.element).outerWidth(!0),height:t(this.element).outerHeight(!0)}),e?this.loadingInt=setTimeout(function(){t(a).show()},300):(clearTimeout(this.loadingInt),t(a).hide())},_debounce:function(t,e){var a=null;return function(){var i=this,s=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(i,s)},e)}},getCurrentData:function(){return this.currentData},load:function(){if(this.settings.url&&!this.loading){var e=this,a="";this._loading(!0),this.loading=!0,t.ajax({type:"GET",url:this.settings.url,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(i){if(e.loading=!1,i){e.pages=parseInt(i.total/e.settings.limit,10),i.total%e.settings.limit>0&&e.pages++,e.total=i.total,e._pagination(),e.currentData={};for(var s in i.items){var r=i.items[s];e.currentData[r._id]=r,a+="<tr>";for(var n in e.header)if(e.header[n]===e.element.id+"ID")a+='<td><input type="checkbox" id="'+r._id+'" class="za-checkbox '+e.element.id+'Checkbox"></td>';else{var o=!1,d=e.header[n].replace(new RegExp("^"+e.element.id+"_"),"");for(var l in r)l===d&&e.settings.fields[l]&&(r[l]&&"string"==typeof r[l]&&(r[l]=r[l].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),a+="<td>"+e.settings.fields[l].process(l,r,r[l])+"</td>",o=!0);o||(e.settings.fields[d]&&e.settings.fields[d].process?a+="<td>"+e.settings.fields[d].process(d,r)+"</td>":a+="<td></td>")}a+="</tr>"}t(e.element).find("tbody").html(a.length?a:e._template(e.settings.html.errorHTML,{error:e.settings.lang.noitems})),e._loading(!1),t('*[data-page="'+e.page+'"]').parent().addClass("za-active"),e._bindSelectButtons(),e.settings.sort.field&&e._sortIndicator(e.settings.sort.field,e.settings.sort.direction),t(e.element).find("thead").show(),e.settings.onLoad()}else e.loading=!1,e._loading(!1),t(e.element).find("tbody").html(e._template(e.settings.html.errorHTML,{error:e.settings.lang.error}))}).fail(function(){e.loading=!1,e._loading(!1),t(e.element).find("tbody").html(e._template(e.settings.html.errorHTML,{error:e.settings.lang.error}))})}}}),t.fn[a]=function(i){var s=void 0;return this.each(function(){(s=t.data(this,"plugin_"+a))||(s=new e(this,i),t.data(this,"plugin_"+a,s))}),s}}(jQuery,window,document);var _slicedToArray=function(){function t(t,e){var a=[],i=!0,s=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(i=(n=o.next()).done)&&(a.push(n.value),!e||a.length!==e);i=!0);}catch(t){s=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(s)throw r}}return a}return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),getUrlParam=function(t){var e=decodeURIComponent(window.location.search.substring(1)).split("&"),a=void 0,i=void 0;for(i=0;i<e.length;i++)if((a=e[i].split("="))[0]===t)return void 0===a[1]||a[1]},processTemplate=function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t=t.replace(new RegExp("({([^}]+)})","ig"),"")},processState=function(t){var e=t||{action:getUrlParam("action"),id:getUrlParam("id")};switch(e.action){case"view":viewOrder(e.id);break;default:$("#zoiaSpinnerMain").hide(),$("#wrapOrder").hide(),$("#wrapOrders").show()}},viewOrder=function(t){$("#zoiaSpinnerMain").show(),$("#orderID").html(t),$.ajax({type:"POST",url:"/api/warehouse/orders/load",data:{id:t},cache:!1}).done(function(t){if($("#zoiaSpinnerMain").hide(),1===t.status&&t.item){var e=t.item;$("#za_order_date").html(new Date(1e3*parseInt(e.date,10)).toLocaleString()),$("#za_order_status").html(lang.orderStatuses[e.status]),$("#za_order_delivery").html(deliveryData[e.delivery]),e.tracking&&e.tracking.length?($(".za-order-tracking-wrap").show(),$("#za_order_tracking").html(e.tracking)):$(".za-order-tracking-wrap").hide();var a='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive"><tbody>';for(var i in e.cart){var s=i.split("|"),r=_slicedToArray(s,2),n=r[0],o=r[1],d="";for(var l in e.cart[i].checkboxes)t.propertiesData[e.cart[i].checkboxes[l]]&&(d+="<br>"+t.propertiesData[e.cart[i].checkboxes[l]]);for(var c in e.cart[i].integers){var h=e.cart[i].integers[c].split("|"),p=_slicedToArray(h,2),g=p[0],m=p[1];t.propertiesData[g]&&(d+="<br>"+t.propertiesData[g]+"&nbsp;("+m+")")}for(var u in e.cart[i].selects){var f=e.cart[i].selects[u].split("|"),b=_slicedToArray(f,2),v=b[0],_=b[1];if(t.propertiesData[v]){var w=t.propertiesData[v].split("|"),z=_slicedToArray(w,2);d+="<br>"+z[0]+":&nbsp;"+z[1].split(",")[_]}}a+='<tr><td class="za-table-shrink">'+n+'</td><td class="za-table-expand">'+t.cartData[n]+(o?"&nbsp;("+t.variants[o]+")":"")+d+'</td><td class="za-table-shrink">'+e.cart[i].count+'</td><td class="za-table-shrink"></td></tr>'}a+="</tbody></table>",$("#za_order_cart").html(a);var y='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive" id="za_catalog_order_costs_table"><tbody>';y+='<tr><td class="za-table-expand">'+lang["Wares cost"]+'</td><td class="za-table-shrink">'+e.costs.totalWares+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>',y+='<tr><td class="za-table-expand">'+lang.Delivery+'</td><td class="za-table-shrink">'+e.costs.delivery+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>';for(var k in e.costs.extra)y+='<tr><td class="za-table-expand">'+t.addressData[k]+'</td><td class="za-table-shrink">'+e.costs.extra[k]+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>';y+='<tr><td class="za-table-expand">'+lang.Total+'</td><td class="za-table-shrink">'+e.costs.total+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>',y+="</tbody></table>",$("#za_order_costs").html(y);var x="";if("pickup"!==t.delivery.delivery){$(".za-catalog-metadata-wrap").addClass("za-grid-divider");for(var T in e.address)addressData[T]&&addressData[T][e.address[T]]&&(e.address[T]=addressData[T][e.address[T]]);x=processTemplate(addressTemplate.data,e.address)}else $(".za-catalog-metadata-wrap").removeClass("za-grid-divider");$("#za_order_address").html(x),e.paid?($("#za_order_status_badge_paid").show(),$("#za_order_status_badge_unpaid").hide(),$("#za_order_btn_pay").hide()):($("#za_order_status_badge_paid").hide(),$("#za_order_status_badge_unpaid").show(),$("#za_order_btn_pay").attr("href",$("#za_order_btn_pay").attr("data")+"/payment?id="+e._id),$("#za_order_btn_pay").show()),$("#wrapOrders").hide(),$("#wrapOrder").show()}else window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})}).fail(function(){$("#zoiaSpinnerMain").hide(),window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})})},ordersTableData={url:"/api/warehouse/orders",limit:20,sort:{field:"_id",direction:"desc"},fields:{_id:{sortable:!0,process:function(t,e,a){return a}},date:{sortable:!0,process:function(t,e,a){return new Date(1e3*parseInt(a,10)).toLocaleString()}},costs:{sortable:!1,process:function(t,e,a){return a.total+"&nbsp;"+settings.currency}},status:{sortable:!0,process:function(t,e,a){return lang.orderStatuses[a]}},actions:{sortable:!1,process:function(t,e){return'<button class="za-icon-button zoia-order-view-btn" za-icon="icon:more" data="'+e._id+'" style="margin-right:5px"></button>'}}},onLoad:function(){$(".zoia-order-view-btn").unbind().click(function(){window.history.pushState({action:"view",id:$(this).attr("data")},document.title,"/catalog/orders?action=view&id="+$(this).attr("data")),viewOrder($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}};$(document).ready(function(){$("#orders").zoiaTable(ordersTableData),window.setTimeout(function(){$(window).bind("popstate",function(t){processState(t.originalEvent.state)}),processState()},0)});