"use strict";var _slicedToArray=function(){return function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return function(a,t){var r=[],e=!0,s=!1,i=void 0;try{for(var o,d=a[Symbol.iterator]();!(e=(o=d.next()).done)&&(r.push(o.value),!t||r.length!==t);e=!0);}catch(a){s=!0,i=a}finally{try{!e&&d.return&&d.return()}finally{if(s)throw i}}return r}(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),getUrlParam=function(a){var t=decodeURIComponent(window.location.search.substring(1)).split("&"),r=void 0,e=void 0;for(e=0;e<t.length;e++)if((r=t[e].split("="))[0]===a)return void 0===r[1]||r[1]},processTemplate=function(a,t){for(var r in t)a=a.replace(new RegExp("{"+r+"}","g"),t[r]);return a=a.replace(new RegExp("({([^}]+)})","ig"),"")},processState=function(a){var t=a||{action:getUrlParam("action"),id:getUrlParam("id")};switch(t.action){case"view":viewOrder(t.id);break;default:$("#zoiaSpinnerMain").hide(),$("#wrapOrder").hide(),$("#wrapOrders").show()}},viewOrder=function(a){$("#zoiaSpinnerMain").show(),$("#orderID").html(a),$.ajax({type:"POST",url:"/api/warehouse/orders/load",data:{id:a},cache:!1}).done(function(a){if($("#zoiaSpinnerMain").hide(),1===a.status&&a.item){var t=a.item;$("#za_order_date").html(new Date(1e3*parseInt(t.date,10)).toLocaleString()),$("#za_order_status").html(lang.orderStatuses[t.status]),$("#za_order_delivery").html(deliveryData[t.delivery]),t.tracking&&t.tracking.length?($(".za-order-tracking-wrap").show(),$("#za_order_tracking").html(t.tracking)):$(".za-order-tracking-wrap").hide();var r='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive"><tbody>';for(var e in t.cart){var s=e.split("|"),i=_slicedToArray(s,2),o=i[0],d=i[1],n="";for(var l in t.cart[e].checkboxes)a.propertiesData[t.cart[e].checkboxes[l]]&&(n+="<br>"+a.propertiesData[t.cart[e].checkboxes[l]]);for(var c in t.cart[e].integers){var p=t.cart[e].integers[c].split("|"),b=_slicedToArray(p,2),u=b[0],h=b[1];a.propertiesData[u]&&(n+="<br>"+a.propertiesData[u]+"&nbsp;("+h+")")}r+='<tr><td class="za-table-shrink">'+o+'</td><td class="za-table-expand">'+a.cartData[o]+(d?"&nbsp;("+a.variants[d]+")":"")+n+'</td><td class="za-table-shrink">'+t.cart[e].count+'</td><td class="za-table-shrink"></td></tr>'}r+="</tbody></table>",$("#za_order_cart").html(r);var z='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive" id="za_catalog_order_costs_table"><tbody>';z+='<tr><td class="za-table-expand">'+lang["Wares cost"]+'</td><td class="za-table-shrink">'+t.costs.totalWares+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>',z+='<tr><td class="za-table-expand">'+lang.Delivery+'</td><td class="za-table-shrink">'+t.costs.delivery+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>';for(var g in t.costs.extra)z+='<tr><td class="za-table-expand">'+a.addressData[g]+'</td><td class="za-table-shrink">'+t.costs.extra[g]+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>';z+='<tr><td class="za-table-expand">'+lang.Total+'</td><td class="za-table-shrink">'+t.costs.total+"&nbsp;"+settings.currency+'</td><td class="za-table-shrink"></td></tr>',z+="</tbody></table>",$("#za_order_costs").html(z);var _="";if("pickup"!==a.delivery.delivery){$(".za-catalog-metadata-wrap").addClass("za-grid-divider");for(var f in t.address)addressData[f]&&addressData[f][t.address[f]]&&(t.address[f]=addressData[f][t.address[f]]);_=processTemplate(addressTemplate.data,t.address)}else $(".za-catalog-metadata-wrap").removeClass("za-grid-divider");$("#za_order_address").html(_),t.paid?($("#za_order_status_badge_paid").show(),$("#za_order_status_badge_unpaid").hide(),$("#za_order_btn_pay").hide()):($("#za_order_status_badge_paid").hide(),$("#za_order_status_badge_unpaid").show(),$("#za_order_btn_pay").attr("href",$("#za_order_btn_pay").attr("data")+"/payment?id="+t._id),$("#za_order_btn_pay").show()),$("#wrapOrders").hide(),$("#wrapOrder").show()}else window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})}).fail(function(){$("#zoiaSpinnerMain").hide(),window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})})},ordersTableData={url:"/api/warehouse/orders",limit:20,sort:{field:"_id",direction:"desc"},fields:{_id:{sortable:!0,process:function(a,t,r){return r}},date:{sortable:!0,process:function(a,t,r){return new Date(1e3*parseInt(r,10)).toLocaleString()}},costs:{sortable:!1,process:function(a,t,r){return r.total+"&nbsp;"+settings.currency}},status:{sortable:!0,process:function(a,t,r){return lang.orderStatuses[r]}},actions:{sortable:!1,process:function(a,t){return'<button class="za-icon-button zoia-order-view-btn" za-icon="icon:more" data="'+t._id+'" style="margin-right:5px"></button>'}}},onLoad:function(){$(".zoia-order-view-btn").unbind().click(function(){window.history.pushState({action:"view",id:$(this).attr("data")},document.title,"/catalog/orders?action=view&id="+$(this).attr("data")),viewOrder($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}};$(document).ready(function(){$("#orders").zoiaTable(ordersTableData),window.setTimeout(function(){$(window).bind("popstate",function(a){processState(a.originalEvent.state)}),processState()},0)});