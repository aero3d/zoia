"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t="zoiaFormBuilder",i={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:{bullet}</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}{html}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslistItemFixed:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right">{key}</div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:{bullet}</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom {prefix}-formBuilder-valueslist-wrap">{items}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:120%">&#8226;</span>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match",parameter:"Parameter",value:"Value"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"uk-form-danger"},a=function(a,s){this.element=a,this.settings=e.extend({},i,s),this._defaults=i,this._name=t,this._prefix=this.element.id,this._formTypes=["text","email","password","select","passwordConfirm","captcha","launcher","textarea","checkboxlist","valueslist","valueslistfixed","valueslisteditable"],this._saving=!1,this.init()};e.extend(a.prototype,{init:function(){var t="",i="";for(var a in this.settings.items){var s=this.settings.items[a],l="";switch((s.validation&&!this.settings.edit&&s.validation.mandatoryCreate||s.validation&&this.settings.edit&&s.validation.mandatoryEdit)&&(l=this.settings.html.bullet),s.type){case"text":case"email":case"password":t+=this._template(this.settings.html.text,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type});break;case"launcher":t+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:a,label:s.label,bullet:l,labelBtn:s.labelBtn,data:s.data,value:s.value,css:s.css?" "+s.css:"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",html:s.html?" "+s.html:""});break;case"valueslist":var r="";for(var n in s.values)r+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:a,key:s.values[n].p,value:s.values[n].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:a,label:s.label,bullet:l,items:r});break;case"valueslisteditable":var o="";for(var u in s.values)o+=this._template(this.settings.html.valueslistItemEditable,{prefix:this._prefix,name:a,key:s.values[u].p,value:s.values[u].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslistEditable,{prefix:this._prefix,name:a,label:s.label,bullet:l,items:o,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",buttons:s.buttons||""});break;case"valueslistfixed":var p="";for(var f in s.values)p+=this._template(this.settings.html.valueslistItemFixed,{prefix:this._prefix,name:a,key:s.values[f].p,value:s.values[f].t,data:s.values[f].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslistFixed,{prefix:this._prefix,name:a,label:s.label,bullet:l,items:p});break;case"select":var d="";for(var c in s.values)d+='<option value="'+c+'">'+s.values[c]+"</option>";t+=this._template(this.settings.html.select,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type,values:d});break;case"checkboxlist":var v="";for(var h in s.values)v+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:a,title:s.values[h]});t+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",items:v});break;case"passwordConfirm":t+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":t+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:a,css:s.css?" "+s.css:"",label:s.label,bullet:l,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",autofocus:s.autofocus?"autofocus":""});break;case"textarea":t+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:a,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):""});break;case"buttons":for(var m="",x=0;x<s.buttons.length;x++){var b=s.buttons[x];m+=this._template(this.settings.html.button,{css:b.css?" "+b.css:"",prefix:this._prefix,name:b.name||"button"+x,type:b.type||"button",label:b.label||""})+"&nbsp;"}i+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:s.css?" "+s.css:"",buttons:m,html:s.html?" "+s.html:""})}}e(this.element).html(this._template(this.settings.template.fields,{fields:t})+this._template(this.settings.template.buttons,{buttons:i})),e(".formBuilder-valueslist-btnAdd").unbind(),e(".formBuilder-valueslist-btnAdd").click(function(t){g._valueslistAddFunc(e(this).attr("data-prefix"),e(this).attr("data-name"),"","")}),e(".formBuilder-valueslist-btnDel").unbind(),e(".formBuilder-valueslist-btnDel").click(function(t){e(this).parent().parent().remove()}),e(".formBuilder-valueslistfixed-btnAdd").unbind(),e(".formBuilder-valueslistfixed-btnAdd").click(function(t){g._valueslistfixedAddFunc(e(this).attr("data-prefix"),e(this).attr("data-name"),"","")}),e(".formBuilder-valueslistfixed-btnDel").unbind(),e(".formBuilder-valueslistfixed-btnDel").click(function(t){e(this).parent().parent().remove()}),e(".formBuilder-valueslisteditable-btnAdd").unbind(),e(".formBuilder-valueslisteditable-btnAdd").click(function(t){g._valueslistAddFunc(e(this).attr("data-prefix"),e(this).attr("data-name"),"","")}),e(".formBuilder-valueslisteditable-btnDel").unbind(),e(".formBuilder-valueslisteditable-btnDel").click(function(t){e(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var g=this;e(this.element).submit(function(e){e.preventDefault(),g._submit()}),this._captchaInit()},_valueslistAddFunc:function(t,i,a,s,l){var r=this._template(this.settings.html.valueslistItem,{prefix:t,name:i,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e("#"+t+"_"+i+"_wrap").append(r),l||e("."+t+"-"+i+"-item").last().find("div>input:first").focus(),e(".formBuilder-valueslist-btnDel").unbind(),e(".formBuilder-valueslist-btnDel").click(function(t){t.stopPropagation(),e(this).parent().parent().remove()})},_valueslisteditableAddFunc:function(t,i,a,s,l,r){if(a){var n=this._template(this.settings.html.valueslistItemEditable,{prefix:t,name:i,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,data:l,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e("#"+t+"_"+i+"_wrap").append(n),r||e("."+t+"-"+i+"-item").last().find("div>input:first").focus(),e(".formBuilder-valueslisteditable-btnDel").unbind(),e(".formBuilder-valueslisteditable-btnDel").click(function(t){t.stopPropagation(),e(this).parent().parent().remove()})}},_valueslistfixedAddFunc:function(t,i,a,s,l){var r=this._template(this.settings.html.valueslistfixedItem,{prefix:t,name:i,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e("#"+t+"_"+i+"_wrap").append(r),l||e("."+t+"-"+i+"-item").last().find("div>input:first").focus(),e(".formBuilder-valueslistfixed-btnDel").unbind(),e(".formBuilder-valueslistfixed-btnDel").click(function(t){t.stopPropagation(),e(this).parent().parent().remove()})},setValidation:function(e){this.validation=e},setEditMode:function(e){this.settings.edit=e},clearErrors:function(){e("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),e("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors();e("."+this._prefix+"-form-field").not(".zoiaFormBuilder-no-reset").val(""),e("select."+this._prefix+"-form-field").prop("selectedIndex",0),e(".formBuilder-valueslist-val").val(""),e("."+this._prefix+"-formBuilder-valueslist-wrap").html("");for(var t in this.settings.items){var i=this.settings.items[t];i.default&&e("#"+this._prefix+"_"+t).val(i.default),"launcher"===i.type&&(e("#"+this._prefix+"_"+t+"_val").html(i.value),e("#"+this._prefix+"_"+t+"_val").attr("data",i.data)),"checkboxlist"===i.type&&e("."+this._prefix+"-"+t+"-cbx").prop("checked",!1)}},serialize:function(){var t=this,i={};for(var a in this.settings.items){var s=this.settings.items[a];-1!==this._formTypes.indexOf(s.type)&&function(){switch(s.type){case"launcher":i[a]={type:s.type,value:e("#"+t._prefix+"_"+a+"_val").html(),id:e("#"+t._prefix+"_"+a+"_val").attr("data")};break;case"checkboxlist":var l=e("."+t._prefix+"-"+a+"-cbx:checked").map(function(){return e(this).attr("data")}).get();i[a]={type:s.type,value:l.join(",")};break;case"valueslist":var r=[];e("."+t._prefix+"-"+a+"-item").each(function(){r.push({p:String(e(this).find("*>.formBuilder-valueslist-par").val()),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),i[a]={type:s.type,value:r};break;case"valueslisteditable":var n=[];e("."+t._prefix+"-"+a+"-item").each(function(){n.push({p:String(e(this).find("*>.formBuilder-valueslist-par").html()),v:String(e(this).find("*>.formBuilder-valueslist-val").val()),d:String(e(this).find("*>.formBuilder-valueslist-val").attr("data"))})}),i[a]={type:s.type,value:n};break;case"valueslistfixed":var o=[];e("."+t._prefix+"-"+a+"-item").each(function(){o.push({p:String(e(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),i[a]={type:s.type,value:o};break;default:i[a]={type:s.type,value:e("#"+t._prefix+"_"+a).val()}}}()}return i},deserialize:function(t){if(t&&"object"===(void 0===t?"undefined":_typeof(t)))for(var i in this.settings.items)switch(t[i]||(t[i]={id:"",value:""}),t[i].type){case"launcher":e("#"+this._prefix+"_"+i+"_val").html(t[i].value),e("#"+this._prefix+"_"+i+"_val").attr("data",t[i].id);break;case"checkboxlist":var a=t[i].value.split(",");for(var s in a)e('.editForm-groups-cbx[data="'+a[s]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var r in t[i].value)l.push(t[i].value[r].p),l.push(t[i].value[r].v);for(e("#"+this._prefix+"_"+i+"_wrap").html("");l.length>0;){var n=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,i,n,o,!0)}break;case"valueslisteditable":var u=[];for(var p in t[i].value)u.push(t[i].value[p].p),u.push(t[i].value[p].v),u.push(t[i].value[p].d);for(e("#"+this._prefix+"_"+i+"_wrap").html("");u.length>0;){var f=u.shift(),d=u.shift(),c=u.shift();this._valueslisteditableAddFunc(this._prefix,i,f,d,c,!0)}break;case"valueslistfixed":e("."+this._prefix+"-"+i+"-item-val").val("");for(var v in t[i].value)e("."+this._prefix+"-"+i+'-item-val[data="'+t[i].value[v].p+'"]').val(t[i].value[v].v);break;default:e("#"+this._prefix+"_"+i).val(t[i].value||"")}},deserializePart:function(t,i){if(i&&"object"===(void 0===i?"undefined":_typeof(i)))switch(i||(i={id:"",value:""}),i.type){case"launcher":e("#"+this._prefix+"_"+t+"_val").html(i.value),e("#"+this._prefix+"_"+t+"_val").attr("data",i.id);break;case"checkboxlist":var a=i.value.split(",");for(var s in a)e('.editForm-groups-cbx[data="'+a[s]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var r in i.value)l.push(i.value[r].p),l.push(i.value[r].v);for(e("#"+this._prefix+"_"+t+"_wrap").html("");l.length>0;){var n=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,t,n,o,!0)}break;case"valueslisteditable":var u=[];for(var p in i.value)u.push(i.value[p].p),u.push(i.value[p].v),u.push(i.value[p].d);for(e("#"+this._prefix+"_"+t+"_wrap").html("");u.length>0;){var f=u.shift(),d=u.shift(),c=u.shift();this._valueslisteditableAddFunc(this._prefix,t,f,d,c,!0)}break;case"valueslistfixed":e("."+this._prefix+"-"+t+"-item-val").val("");for(var v in i.value)e("."+this._prefix+"-"+t+'-item-val[data="'+i.value[v].p+'"]').val(i.value[v].v);break;default:e("#"+this._prefix+"_"+t).val(i.value||"")}},loadJSON:function(t){var i=this,a=this;jQuery.each(t,function(t,s){if(e("#"+a._prefix+"_"+t).val(s),a.settings.items[t]&&"checkboxlist"===a.settings.items[t].type&&s){var l=s.split(",");for(var r in l)e('.editForm-groups-cbx[data="'+l[r]+'"]').prop("checked",!0)}if(a.settings.items[t]&&"valueslist"===a.settings.items[t].type&&s){var n=[];for(var o in s)n.push(o),n.push(s[o]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var u in s)a._valueslistAddFunc(a._prefix,t,n.shift(),n.shift())}if(a.settings.items[t]&&"valueslisteditable"===a.settings.items[t].type&&s){console("value: "+s);var p=[];for(var f in s)p.push(f),p.push(s[f]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var d in s)a._valueslisteditableAddFunc(a._prefix,t,p.shift(),p.shift(),p.shift())}if(a.settings.items[t]&&"valueslistfixed"===a.settings.items[t].type&&s){e("."+i._prefix+"-"+t+"-item-val").val("");for(var c in s)e("."+i._prefix+"-"+t+'-item-val[data="'+s[c].p+'"]').val(s[c].v)}})},loadData:function(t){var i=this;this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var a=this;e.ajax({type:this.settings.load.method,url:this.settings.load.url,data:t,cache:!1}).done(function(t){t&&1===t.status?(jQuery.each(t.item,function(t,s){if(e("#"+a._prefix+"_"+t).val(s),a.settings.items[t]&&"checkboxlist"===a.settings.items[t].type&&s){var l=s.split(",");for(var r in l)e('.editForm-groups-cbx[data="'+l[r]+'"]').prop("checked",!0)}if(a.settings.items[t]&&"valueslist"===a.settings.items[t].type&&s){var n=[];for(var o in s)n.push(o),n.push(s[o]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var u in s)a._valueslistAddFunc(a._prefix,t,n.shift(),n.shift())}if(a.settings.items[t]&&"valueslisteditable"===a.settings.items[t].type&&s){var p=[];for(var f in s)p.push(f),p.push(s[f]);e("#"+a._prefix+"_"+t+"_wrap").html("");for(var d in s)a._valueslisteditableAddFunc(a._prefix,t,p.shift(),p.shift())}if(a.settings.items[t]&&"valueslistfixed"===a.settings.items[t].type&&s){e("."+i._prefix+"-"+t+"-item-val").val("");for(var c in s)e("."+i._prefix+"-"+t+'-item-val[data="'+s[c].p+'"]').val(s[c].v)}}),a.settings.events.onLoadSuccess&&a.settings.events.onLoadSuccess(t)):a.settings.events.onLoadError&&a.settings.events.onLoadError(t)}).fail(function(e,t){a.settings.events.onLoadError&&a.settings.events.onLoadError(e,t)})},captchaRefresh:function(){e("."+this._prefix+"-captcha-img").show(),e("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),e("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var t=this;e("img."+this._prefix+"-captcha-img").click(function(){t.captchaRefresh()})},_template:function(e,t){for(var i in t)e=e.replace(new RegExp("{"+i+"}","g"),t[i]);return e},validate:function(t){var i=this,a={},s={};for(var l in this.settings.items){var r=this.settings.items[l];if(-1!==this._formTypes.indexOf(r.type))if("launcher"!==r.type){if("valueslist"===r.type)if("continue"===function(){if(t&&t[l])return s[l]=t[l].value,"continue";var a=[];return e("."+i._prefix+"-"+l+"-item").each(function(){a.push({p:String(e(this).find("*>.formBuilder-valueslist-par").val()),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=a,"continue"}())continue;if("valueslisteditable"===r.type)if("continue"===function(){if(t&&t[l])return s[l]=t[l].value,"continue";var a=[];return e("."+i._prefix+"-"+l+"-item").each(function(){a.push({p:String(e(this).find("*>.formBuilder-valueslist-par").val()),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=a,"continue"}())continue;if("valueslistfixed"===r.type)if("continue"===function(){if(t&&t[l])return s[l]=t[l].value,"continue";var a=[];return e("."+i._prefix+"-"+l+"-item").each(function(){a.push({p:String(e(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(e(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=a,"continue"}())continue;if("checkboxlist"!==r.type){var n=t?t[l]?t[l].value:void 0:e("#"+this._prefix+"_"+l).val();if(r.validation){if(!r.validation.mandatoryEdit&&!n&&this.settings.edit||!r.validation.mandatoryCreate&&!n&&!this.settings.edit)continue;if(r.validation.mandatoryCreate&&!n&&!this.settings.edit){a[l]=this.settings.lang.mandatoryMissing;continue}if(r.validation.mandatoryEdit&&!n&&this.settings.edit){a[l]=this.settings.lang.mandatoryMissing;continue}if(r.validation.process&&"function"==typeof r.validation.process&&(n=r.validation.process(n)),"passwordConfirm"===r.type)if(e("#"+this._prefix+"_"+l+"Confirm").val()!==n){a[l]=this.settings.lang.passwordsNotMatch;continue}if(r.validation.length){if(r.validation.length.min&&n.length<r.validation.length.min){a[l]=this.settings.lang.tooShort;continue}if(r.validation.length.max&&n.length>r.validation.length.max){a[l]=this.settings.lang.tooLong;continue}}if(r.validation.regexp&&!n.match(r.validation.regexp)){a[l]=this.settings.lang.invalidFormat;continue}s[l]=n}}else{var o=e("."+this._prefix+"-"+l+"-cbx:checked").map(function(){return e(this).attr("data")}).get();s[l]=t?t[l]?t[l].value:void 0:o.join(",")}}else s[l]=t?t[l]?t[l].id:void 0:e("#"+this._prefix+"_"+l+"_val").attr("data")}return{data:s,errors:a}},errors:function(t){if(Object.keys(t).length>0){var i=!1;for(var a in t)e("#"+this._prefix+"_"+a).addClass(this.settings.formDangerClass),e("#"+this._prefix+"_"+a+"_error_text > span").html(t[a]),e("#"+this._prefix+"_"+a+"_error_text").show(),i||(e("#"+this._prefix+"_"+a).focus(),i=!0),"passwordConfirm"===this.settings.items[a].type&&e("#"+this._prefix+"_"+a+"Confirm").addClass(this.settings.formDangerClass);return!0}return!1},_submit:function(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var t=this,i={},a={};if(this.settings.validation){var s=this.validate();if(i=s.data||{},a=s.errors||{},this.errors(a))return;if(this.settings.events.onSaveValidate&&"__stop"===(i=this.settings.events.onSaveValidate(i,a)||i))return}else if(this.settings.events.onSaveValidate&&"__stop"===(i=this.settings.events.onSaveValidate(i)))return;t._saving=!0,e.ajax({type:this.settings.save.method,url:this.settings.save.url,data:i,cache:!1}).done(function(i){if(t._saving=!1,i&&1===i.status)t.settings.events.onSaveSuccess&&t.settings.events.onSaveSuccess(i);else{if(i.fields)for(var a in i.fields){var s=!1;e("#"+t._prefix+"_"+i.fields[a]).addClass(t.settings.formDangerClass),s||(e("#"+t._prefix+"_"+i.fields[a]).focus(),s=!0)}t.captchaRefresh(),t.settings.events.onSaveError&&t.settings.events.onSaveError(i)}}).fail(function(e,i){t._saving=!1,t.captchaRefresh(),t.settings.events.onSaveError&&t.settings.events.onSaveError(e,i)})}}}),e.fn[t]=function(i){var s=void 0;return this.each(function(){(s=e.data(this,"plugin_"+t))||(s=new a(this,i),e.data(this,"plugin_"+t,s))}),s}}(jQuery,window,document),$(document).ready(function(){$("#zoiaResetConfirm").zoiaFormBuilder({save:{url:"/api/auth/reset/confirm",method:"POST"},formDangerClass:"za-form-danger",template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:lang["Should not be empty"],tooShort:lang["Too short"],tooLong:lang["Too long"],invalidFormat:lang["Doesn't match required format"],passwordsNotMatch:lang["Passwords do not match"]},html:{helpText:'<div class="za-text-meta">{text}</div>',text:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><input class="za-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',select:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><select class="za-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-flex"><div class="{prefix}-field-wrap"><input class="za-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="za-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',captcha:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-grid za-grid-small"><div><input class="za-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="za-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="za-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}_btn">{label}:</label><div class="za-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="za-button za-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}</div>',textarea:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><textarea class="za-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>'},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(e){return $("#zoiaResetConfirmSpinner").show(),$("#zoiaResetConfirm_btnSave").toggleClass("za-button-primary").toggleClass("za-button-default"),e.username=usernameConfirm,e.code=codeConfirm,e},onSaveSuccess:function(){$("#zoiaResetConfirm").hide(),$("#resetConfirmSuccessful").show(),$("html, body").animate({scrollTop:$("#zoiaResetConfirm").offset().top-20},"fast")},onSaveError:function(){$("#zoiaResetConfirmSpinner").hide(),$("#zoiaResetConfirm_btnSave").toggleClass("za-button-primary").toggleClass("za-button-default"),$("#zoiaResetConfirm_password").focus(),$zUI.notification(lang["Error while setting new password"],{status:"danger"})}},items:{password:{autofocus:!0,type:"passwordConfirm",label:lang.Password,helpText:lang["Minimal length: 5 characters, type twice to verify"],validation:{mandatoryCreate:!0,length:{min:5,max:50},process:function(e){return e.trim()}}},buttons:{type:"buttons",css:"za-margin-top",buttons:[{name:"btnSave",label:'<div za-spinner class="za-margin-right" id="zoiaResetConfirmSpinner" style="display:none"></div>'+lang.Set,css:"za-button-primary",type:"submit"}]}}})});